name: Healthcheck Monitor
on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  healthcheck:
    runs-on: ubuntu-latest
    steps:
      - name: Check service
        id: healthcheck
        continue-on-error: true
        run: |
          if curl -s -f "http://–≤–∞—à-—Å–µ—Ä–≤–∏—Å/healthcheck"; then
            echo "‚úÖ –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç"
            echo "status=ok" >> $GITHUB_OUTPUT
          else
            echo "status=down" >> $GITHUB_OUTPUT
            exit 1
          fi

      - name: Send Telegram alert
        if: steps.healthcheck.outputs.status == 'down'
        run: |
          curl -s -X POST \
            "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_GROUP_CHAT_ID }}" \
            -d "text=üö® –°–µ—Ä–≤–∏—Å —É–ø–∞–ª! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ: http://–≤–∞—à-—Å–µ—Ä–≤–∏—Å/healthcheck"